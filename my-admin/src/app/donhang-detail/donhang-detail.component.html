<div *ngIf="errMessage" class="error">{{ errMessage }}</div>
<div *ngIf="successMessage" class="success">{{ successMessage }}</div>
<div *ngIf="order">
  <h2>Chi tiết đơn hàng: {{ order.OrderID }}</h2>
  <button *ngIf="!editMode" (click)="enableEditMode()">Edit</button>
  <div *ngIf="editMode">
    <label>Khách hàng:</label>
    <select [(ngModel)]="order.CustomerID" *ngIf="customers.length > 0">
      <option *ngFor="let customer of customers" [value]="customer.CustomerID">{{ customer.CustomerName }}</option>
    </select>
    <label>Ngày đặt hàng:</label>
    <input [(ngModel)]="order.OrderDate" type="date" />
    <label>Trạng thái đơn hàng:</label>
    <select [(ngModel)]="order.OrderStatusID" *ngIf="orderStatuses.length > 0">
      <option *ngFor="let status of orderStatuses" [value]="status.OrderStatusID">{{ status.Status }}</option>
    </select>
    <label>Phương thức thanh toán:</label>
    <select [(ngModel)]="order.PaymentMethodID" *ngIf="paymentMethods.length > 0">
      <option *ngFor="let method of paymentMethods" [value]="method.PaymentMethodID">{{ method.PaymentMethod }}</option>
    </select>
    <label>Trạng thái thanh toán:</label>
    <select [(ngModel)]="order.PaymentStatusID" *ngIf="paymentStatuses.length > 0">
      <option *ngFor="let status of paymentStatuses" [value]="status.PaymentStatusID">{{ status.PaymentStatus }}</option>
    </select>
    <h3>Danh sách sản phẩm:</h3>
    <div *ngFor="let item of order.items; let i = index">
      <select [(ngModel)]="item.ProductID" (change)="updateProductPrice(i)" *ngIf="products.length > 0">
        <option *ngFor="let product of products" [value]="product._id">{{ product.name }}</option>
      </select>
      <input [(ngModel)]="item.Quantity" type="number" (change)="updateProductPrice(i)" min="1" />
      <button (click)="removeProduct(i)">Xóa</button>
    </div>
    <button (click)="addProduct()">Thêm sản phẩm</button>
    <p>Tổng tiền: {{ getTotalAmount() }}</p>
    <button (click)="updateOrder()">Lưu</button>
    <button (click)="cancelEdit()">Hủy</button>
  </div>
  <div *ngIf="!editMode">
    <p><strong>Khách hàng:</strong> {{ order.CustomerName }}</p>
    <p><strong>Ngày đặt hàng:</strong> {{ order.OrderDate }}</p>
    <p><strong>Trạng thái đơn hàng:</strong> {{ order.OrderStatusText }}</p>
    <p><strong>Phương thức thanh toán:</strong> {{ order.PaymentMethodText }}</p>
    <p><strong>Trạng thái thanh toán:</strong> {{ order.PaymentStatusText }}</p>
    <h3>Danh sách sản phẩm:</h3>
    <ul>
      <li *ngFor="let item of order.items">
        {{ item.ProductName }} - Số lượng: {{ item.Quantity }} - Tổng giá: {{ item.TotalPrice }}
      </li>
    </ul>
    <p><strong>Tổng tiền:</strong> {{ getTotalAmount() }}</p>
  </div>
  <button (click)="cancel()">Quay lại</button>
</div>

<div *ngIf="isCancelPopupVisible" class="popup">
  <div class="popup-content">
    <p>Bạn có chắc chắn muốn hủy?</p>
    <button (click)="confirmCancel()">Có</button>
    <button (click)="closeCancelPopup()">Không</button>
  </div>
</div>