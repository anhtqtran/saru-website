<div class="max-w-2xl mx-auto bg-white p-6 rounded-lg shadow-lg mt-8">
  <h2 class="text-3xl font-bold text-center mb-6 text-[#B16628]">THÊM ĐƠN HÀNG MỚI</h2>
  <form (ngSubmit)="onSubmit()">
    <!-- Thông tin khách hàng -->
    <div class="mb-4">
      <label class="block text-base font-semibold mt-2 text-[#B16628]">Khách hàng <span class="text-red-500">*</span></label>
      <select
        [(ngModel)]="order.CustomerID"
        name="CustomerID"
        required
        class="w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-[#F8BC3B]"
      >
        <option value="" disabled>Chọn khách hàng</option>
        <option *ngFor="let customer of customers" [value]="customer._id">
          {{ customer.CustomerName }}
        </option>
      </select>
    </div>

    <!-- Ngày đặt hàng -->
    <div class="mb-4">
      <label class="block text-base font-semibold mt-2 text-[#B16628]">Ngày đặt hàng <span class="text-red-500">*</span></label>
      <input
        type="date"
        [(ngModel)]="order.OrderDate"
        name="OrderDate"
        required
        class="w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-[#F8BC3B]"
      />
    </div>

    <!-- Trạng thái đơn hàng -->
    <div class="mb-4">
      <label class="block text-base font-semibold mt-2 text-[#B16628]">Trạng thái đơn hàng <span class="text-red-500">*</span></label>
      <select
        [(ngModel)]="order.OrderStatusID"
        name="OrderStatusID"
        required
        class="w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-[#F8BC3B]"
      >
        <option value="" disabled>Chọn trạng thái</option>
        <option *ngFor="let status of orderStatuses" [value]="status.OrderStatusID">
          {{ status.Status }}
        </option>
      </select>
    </div>

    <!-- Phương thức thanh toán -->
    <div class="mb-4">
      <label class="block text-base font-semibold mt-2 text-[#B16628]">Phương thức thanh toán <span class="text-red-500">*</span></label>
      <select
        [(ngModel)]="order.PaymentMethodID"
        name="PaymentMethodID"
        required
        class="w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-[#F8BC3B]"
      >
        <option value="" disabled>Chọn phương thức</option>
        <option *ngFor="let method of paymentMethods" [value]="method._id">
          {{ method.Method }}
        </option>
      </select>
    </div>

    <!-- Trạng thái thanh toán -->
    <div class="mb-4">
      <label class="block text-base font-semibold mt-2 text-[#B16628]">Trạng thái thanh toán <span class="text-red-500">*</span></label>
      <select
        [(ngModel)]="order.PaymentStatusID"
        name="PaymentStatusID"
        required
        class="w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-[#F8BC3B]"
      >
        <option value="" disabled>Chọn trạng thái</option>
        <option *ngFor="let status of paymentStatuses" [value]="status._id">
          {{ status.Status }}
        </option>
      </select>
    </div>

    <!-- Sản phẩm -->
    <div class="mb-4">
      <label class="block text-base font-semibold mt-2 text-[#B16628]">Sản phẩm <span class="text-red-500">*</span></label>
      <div *ngFor="let item of order.items; let i = index" class="mb-2 flex space-x-2 items-center">
        <select
          [(ngModel)]="item.ProductID"
          [name]="'product_' + i"
          required
          class="w-1/2 px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-[#F8BC3B]"
          (change)="updateProductPrice(i)"
        >
          <option value="" disabled>Chọn sản phẩm</option>
          <option *ngFor="let product of products" [value]="product._id">
            {{ product.name }} ({{ product.price }} VNĐ)
          </option>
        </select>
        <input
          type="number"
          [(ngModel)]="item.Quantity"
          [name]="'quantity_' + i"
          placeholder="Số lượng"
          min="1"
          required
          class="w-1/4 px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-[#F8BC3B]"
          (input)="updateProductPrice(i)"
        />
        <button type="button" (click)="removeProduct(i)" class="text-red-500 hover:text-red-700">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
      <button type="button" (click)="addProduct()" class="text-blue-500 hover:text-blue-700 mt-2">
        + Thêm sản phẩm
      </button>
    </div>

    <!-- Tổng tiền -->
    <div class="mb-4">
      <label class="block text-base font-semibold mt-2 text-[#B16628]">Tổng tiền</label>
      <p class="w-full px-4 py-2 border border-gray-300 rounded-md bg-gray-100">
        {{ getTotalAmount() }} VNĐ
      </p>
    </div>

    <!-- Nút điều khiển -->
    <div class="flex justify-between mt-4 space-x-4">
      <button
        type="button"
        (click)="showCancelPopup()"
        class="bg-[#F8BC3B] text-white px-6 py-2 rounded-md shadow-md hover:bg-[#f0a826]"
      >
        Hủy thay đổi
      </button>
      <button
        type="submit"
        class="bg-[#F8BC3B] text-white px-6 py-2 rounded-md shadow-md hover:bg-[#f0a826]"
        [disabled]="isSubmitting"
      >
        Lưu
      </button>
    </div>
  </form>
</div>

<!-- Pop-up xác nhận hủy -->
<div *ngIf="isCancelPopupVisible" class="fixed inset-0 bg-[#F2E8DA] bg-opacity-50 flex justify-center items-center z-50">
  <div class="bg-white p-6 rounded-lg shadow-lg text-center">
    <p class="text-lg font-semibold mb-4 text-gray-800">Bạn chắc chắn muốn hủy thay đổi?</p>
    <button (click)="confirmCancel()" class="bg-[#F8BC3B] text-white px-6 py-2 rounded-md shadow-md mr-2 hover:bg-[#f0a826]">
      Xác nhận
    </button>
    <button (click)="closeCancelPopup()" class="border border-[#F8BC3B] text-[#F8BC3B] px-6 py-2 rounded-md shadow-md hover:bg-[#F8BC3B] hover:text-white transition">
      Hủy
    </button>
  </div>
</div>